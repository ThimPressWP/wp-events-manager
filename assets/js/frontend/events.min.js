!function(e){var t={init(){const t=e(document);t.on("click",".event-load-booking-form",this.load_form_register),t.on("submit","form.event_register:not(.active)",this.book_event_form),this.sanitize_form_field(),t.on("submit","#event-lightbox .event-auth-form",this.ajax_login)},load_form_register(n){n.preventDefault();const o=e(this),i=o.attr("data-event");return e.ajax({url:WPEMS.ajaxurl,type:"POST",dataType:"html",async:!1,data:{event_id:i,nonce:WPEMS.register_button,action:"load_form_register"},beforeSend(){o.append('<i class="event-icon-spinner2 spinner"></i>')}}).always(function(){o.find(".event-icon-spinner2").remove()}).done(function(e){t.lightbox(e)}).fail(function(){}),!1},book_event_form(n){n.preventDefault();const o=e(this),i=o.serializeArray(),s=o.find('button[type="submit"]'),a=o.find(".tp-event-notice");return e.ajax({url:WPEMS.ajaxurl,type:"POST",data:i,dataType:"json",beforeSend(){a.slideUp().remove(),s.addClass("event-register-loading"),o.addClass("active")}}).done(function(n){s.removeClass("event-register-loading"),void 0!==n.status?(!0===n.status&&void 0!==n.url&&""!==n.url&&(window.location.href=n.url),!0===n.status&&""==n.url&&void 0!==n.event&&(e.magnificPopup.close(),e(".woocommerce-message").hide(),setTimeout(function(){e(".entry-register, .event_register_foot").append('<div class="woocommerce-message">'+WPEMS.woo_cart_url+"<p>“"+n.event+"”"+WPEMS.add_to_cart+"</p></div>")},100)),void 0!==n.message&&t.set_message(o,n.message)):t.set_message(o,WPEMS.something_wrong)}).fail(function(){s.removeClass("event-register-loading"),t.set_message(o,WPEMS.something_wrong)}).always(function(){o.removeClass("active")}),!1},set_message(e,t){let n='<div class="tp-event-notice error">';n+='<div class="event_auth_register_message_error">'+t+"</div>",n+="</div>",e.find(".event_register_foot").append(n)},sanitize_form_field(){const t=e(".form-row.form-required");for(let n=0;n<t.length;n++){e(t[n]).find("input").on("blur",function(t){t.preventDefault();const n=e(this),o=n.parents(".form-row:first");o.hasClass("form-required")&&(""==n.val()?o.removeClass("validated").addClass("has-error"):o.removeClass("has-error").addClass("validated"))})}},lightbox(n){const o=[];o.push('<div id="event-lightbox">'),o.push(n),o.push("</div>"),e.magnificPopup.open({items:{type:"inline",src:e(o.join(""))},mainClass:"event-lightbox-wrap",callbacks:{open(){const n=e("#event-lightbox");n.addClass("event-fade");var o=setTimeout(function(){n.addClass("event-in"),clearTimeout(o),t.sanitize_form_field()},100)},close(){e("#event-lightbox").remove()}}})},ajax_login(t){t.preventDefault();const n=e(this),o=n.find("#wp-submit"),i=e("#event-lightbox"),s=n.serializeArray();return e.ajax({url:WPEMS.ajaxurl,type:"POST",data:s,async:!1,beforeSend(){i.find(".tp-event-notice").slideUp().remove(),o.addClass("event-register-loading")}}).always(function(){o.find(".event-icon-spinner2").remove()}).done(function(e){void 0!==e.notices&&n.before(e.notices),void 0!==e.status&&!0===e.status&&(void 0!==e.redirect&&e.redirect?window.location.href=e.redirect:window.location.reload())}).fail(function(e,t,o){let i='<ul class="tp-event-notice error">';i+="<li>"+e+"</li>",i+="</ul>",n.before(res.notices)}),!1}};e(document).ready(function(){t.init();const n=e(".tp_event_counter");for(var o=0;o<n.length;o++){let t=e(n[o]).attr("data-time");t=new Date(t);const i=new Date(t-60*WPEMS.gmt_offset*60*1e3);e(n[o]).countdown({labels:WPEMS.l18n.labels,labels1:WPEMS.l18n.labels1,until:i,serverSync:WPEMS.current_time})}const i=e(".tp_event_owl_carousel");for(o=0;o<i.length;o++){let t=e(i[o]).attr("data-countdown");var s={navigation:!0,slideSpeed:300,paginationSpeed:400,singleItem:!0};void 0!==t&&(t=JSON.parse(t),e.extend(s,t),e.each(s,function(e,t){"true"===t?s[e]=!0:"false"===t&&(s[e]=!1)})),void 0===s.slide||!0===s.slide?e(i[o]).owlCarousel(s):e(i[o]).removeClass("owl-carousel")}})}(jQuery);